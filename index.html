<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShopNest — Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

<!-- 🔐 Unified Auth Section -->
<section id="authSection" class="min-h-screen flex flex-col justify-center items-center px-4">
  <div class="bg-white shadow-lg p-6 rounded w-full max-w-sm text-center">
    <h2 class="text-2xl font-bold text-indigo-700 mb-4">Welcome to ShopNest</h2>

    <input type="email" id="authEmail" placeholder="Email" class="w-full border px-3 py-2 rounded mb-2" />
    <input type="password" id="authPassword" placeholder="Password" class="w-full border px-3 py-2 rounded mb-2" />

    <select id="authCountry" class="w-full border px-3 py-2 rounded mb-3 hidden">
      <option value="" disabled selected>Select Country</option>
      <option>Nigeria</option>
      <option>USA</option>
      <option>UK</option>
      <option>Ghana</option>
      <option>Kenya</option>
      <option>Canada</option>
      <option>Russia</option>
      <option>Ukraine</option>
      <option>South Africa</option>
      <option>Cameroon</option>
      <option>Ivory Coast</option>
      <option>Uganda</option>
      <option>India</option>
      <option>Germany</option>
      <option>China</option>
      <option>Brazil</option>
      <option>Turkey</option>
      <option>Italy</option>
      <option>Egypt</option>
      <option>Senegal</option>
      <option>France</option>
      <option>Australia</option>
    </select>

    <button id="loginBtn" class="bg-indigo-600 text-white w-full py-2 rounded hover:bg-indigo-700 mb-2">
      <span id="btnText">Login</span>
    </button>

    <button id="registerToggle" class="text-sm text-indigo-600 underline mb-1">Create Account</button>
    <a href="reset.html" class="text-xs text-gray-500 underline">Forgot Password?</a>

    <p id="authMessage" class="text-sm mt-3 text-red-500"></p>
  </div>
</section>

<!-- 🌍 Main Content (hidden by default) -->
<div id="mainContent" class="hidden">
  <div class="flex justify-between items-center px-4 py-3 bg-white shadow">
    <h1 class="text-xl font-bold text-indigo-600">ShopNest</h1>
    <div class="flex items-center space-x-4">
      <a href="#" class="text-sm text-indigo-600">Help Center</a>
      <button id="logoutBtn" class="text-sm bg-red-100 text-red-600 px-2 py-1 rounded hover:bg-red-200">Logout</button>
    </div>
  </div>

  <div class="px-4 mt-2">
    <input type="text" placeholder="Search..." class="w-full p-2 border rounded mb-4" />
  </div>

  <div class="px-4">
    <div class="flex justify-between text-center mb-2 overflow-x-auto">
      <a href="products.html?category=Electronics" class="flex-1 block">
        <div class="p-2 rounded border mx-1">📱</div>
        <p class="text-xs mt-1">Electronics</p>
      </a>
      <a href="products.html?category=Fashion" class="flex-1 block">
        <div class="p-2 rounded border mx-1">👗</div>
        <p class="text-xs mt-1">Fashion</p>
      </a>
      <a href="products.html?category=Real Estate" class="flex-1 block">
        <div class="p-2 rounded border mx-1">🏠</div>
        <p class="text-xs mt-1">Real Estate</p>
      </a>
      <a href="products.html?category=Machinery" class="flex-1 block">
        <div class="p-2 rounded border mx-1">🚜</div>
        <p class="text-xs mt-1">Machinery</p>
      </a>
    </div>
    <div class="text-right">
      <a href="categories.html" class="text-indigo-600 text-sm font-medium">View All Categories →</a>
    </div>
  </div>

  <div class="px-4 mt-4 mb-20">
    <h2 class="text-lg font-semibold mb-2">Featured Products</h2>
    <div id="adsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
  </div>

  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around py-2 text-sm">
    <a href="index.html" class="flex flex-col items-center text-indigo-600">
      <span>🏠</span>
      <span>Home</span>
    </a>
    <a href="search.html" class="flex flex-col items-center text-gray-600">
      <span>🔍</span>
      <span>Search</span>
    </a>
    <a href="post-ad.html" class="flex flex-col items-center text-gray-600">
      <span>➕</span>
      <span>Post Ad</span>
    </a>
    <a href="messages.html" class="flex flex-col items-center text-gray-600">
      <span>💬</span>
      <span>Messages</span>
    </a>
    <a href="profile.html" class="flex flex-col items-center text-gray-600">
      <span>👤</span>
      <span>Profile</span>
    </a>
  </nav>
</div>

<!-- 🔥 Firebase + Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    sendEmailVerification,
    signInWithEmailAndPassword,
    signOut
  } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBx_2_7aqxU5z6sLbbBp0fpdJvOzjarmGE",
    authDomain: "shopnest-4cbdf.firebaseapp.com",
    projectId: "shopnest-4cbdf",
    storageBucket: "shopnest-4cbdf.firebasestorage.app",
    messagingSenderId: "106375353281",
    appId: "1:106375353281:web:cc6d19ddbef840e5715540",
    measurementId: "G-FJ5TFZD45F"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const authSection = document.getElementById("authSection");
  const mainContent = document.getElementById("mainContent");
  const authEmail = document.getElementById("authEmail");
  const authPassword = document.getElementById("authPassword");
  const authCountry = document.getElementById("authCountry");
  const authMessage = document.getElementById("authMessage");
  const loginBtn = document.getElementById("loginBtn");
  const btnText = document.getElementById("btnText");
  const registerToggle = document.getElementById("registerToggle");
  const logoutBtn = document.getElementById("logoutBtn");

  let registerMode = false;

  // Only show index.html after splash
  if (!localStorage.getItem("shopnestPreviewSeen")) {
    window.location.href = "splash.html";
  }

  // Toggle register/login
  registerToggle.onclick = () => {
    registerMode = !registerMode;
    btnText.textContent = registerMode ? "Register" : "Login";
    registerToggle.textContent = registerMode ? "Already have an account? Login" : "Create Account";
    authCountry.classList.toggle("hidden", !registerMode);
  };

  loginBtn.onclick = async () => {
    const email = authEmail.value.trim();
    const password = authPassword.value.trim();
    const country = authCountry.value;

    if (!email || !password || (registerMode && !country)) {
      authMessage.textContent = "Please fill all fields.";
      return;
    }

    btnText.textContent = registerMode ? "Registering..." : "Logging in...";
    loginBtn.disabled = true;

    try {
      if (registerMode) {
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        await sendEmailVerification(userCred.user);
        authMessage.textContent = "Check your email to verify your account.";
      } else {
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        if (!userCred.user.emailVerified) {
          authMessage.textContent = "Please verify your email first.";
          await signOut(auth);
        } else {
          // 🔁 Backend will be connected later
          await fetch("https://your-backend.com/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, country })
          });

          localStorage.setItem("shopnestLoggedIn", "yes");
          authSection.classList.add("hidden");
          mainContent.classList.remove("hidden");
          import('./js/ads.js');
        }
      }
    } catch (err) {
      if (err.code === "auth/email-already-in-use") {
        authMessage.textContent = "Account already exists. Please login.";
      } else if (err.code === "auth/invalid-credential") {
        authMessage.textContent = "Incorrect email or password. Please try again or create an account.";
      } else if (err.code === "auth/weak-password") {
        authMessage.textContent = "Password should be at least 6 characters";
      } else {
        authMessage.textContent = err.message;
      }
    }

    loginBtn.disabled = false;
    btnText.textContent = registerMode ? "Register" : "Login";
  };

  logoutBtn.onclick = async () => {
    btnText.textContent = "Logging out...";
    await signOut(auth);
    localStorage.removeItem("shopnestLoggedIn");
    localStorage.removeItem("shopnestPreviewSeen");
    location.href = "splash.html";
  };

  // Show main content if logged in
  if (localStorage.getItem("shopnestLoggedIn") === "yes") {
    authSection.classList.add("hidden");
    mainContent.classList.remove("hidden");
    import('./js/ads.js');
  } else {
    authSection.classList.remove("hidden");
    mainContent.classList.add("hidden");
  }
</script>
</body>
</html>
